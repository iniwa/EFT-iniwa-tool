<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFT Planner Complete</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="container-fluid py-4">
        
        <div v-if="loadError" class="alert alert-danger text-center">{{ loadError }}</div>

        <comp-header 
            :last-updated="lastUpdated" 
            :is-loading="isLoading" 
            v-model:player-level="playerLevel"
            @fetch-data="fetchData"
            @export-data="exportData"
            @trigger-import="triggerImport">
        </comp-header>

        <input type="file" ref="fileInput" class="d-none" accept=".json" @change="importData">

        <ul class="nav nav-tabs mb-3">
            <li class="nav-item"><a class="nav-link" :class="{active: currentTab === 'input'}" @click="currentTab = 'input'" href="#">1. 進捗入力</a></li>
            <li class="nav-item"><a class="nav-link" :class="{active: currentTab === 'result'}" @click="currentTab = 'result'" href="#">2. 必要なアイテム ({{ totalItemsNeeded }})</a></li>
            <li class="nav-item"><a class="nav-link" :class="{active: currentTab === 'keys'}" @click="currentTab = 'keys'" href="#">3. 鍵管理 ({{ totalKeysNeeded }})</a></li>
        </ul>

        <div v-if="currentTab === 'input'">
            <comp-input
                :hideout-data="hideoutData"
                :user-hideout="userHideout"
                v-model:force-hideout-fir="forceHideoutFir"
                :filtered-tasks-list="filteredTasksList"
                :completed-tasks="completedTasks"
                v-model:task-view-mode="taskViewMode"
                v-model:show-completed="showCompleted"
                v-model:show-future="showFuture"
                v-model:search-task="searchTask"
                :tasks-by-trader="tasksByTrader"
                :tasks-by-map="tasksByMap"
                @open-task-details="openTaskDetails"
                @toggle-task="toggleTask"
            ></comp-input>
        </div>

        <div v-if="currentTab === 'result'">
            <comp-result
                :shopping-list="shoppingList"
                :collected-items="collectedItems"
                :expanded-items="expandedItems"
                :display-lists="displayLists" 
                @toggle-item-details="toggleItemDetails"
                @toggle-collected="toggleCollected"
                @open-task-from-name="openTaskFromName"
            ></comp-result>
        </div>

        <div v-if="currentTab === 'keys'">
            <comp-keys
                :shopping-list="shoppingList"
                :owned-keys="ownedKeys"
                :items-data="itemsData"
                :key-user-data="keyUserData" 
                @toggle-owned-key="toggleOwnedKey"
                @open-task-from-name="openTaskFromName"
                @update-key-user-data="updateKeyUserData"
            ></comp-keys>
        </div>

        <comp-modal
            :selected-task="selectedTask"
            @close="selectedTask = null"
        ></comp-modal>

    </div>

    <script src="data.js"></script>
    <script src="js/queries.js"></script>
    <script src="js/key_presets.js"></script> 
    <script src="js/logic_hideout.js"></script>
    <script src="js/logic_tasks.js"></script>
    <script src="js/logic_keys.js"></script>
    <script src="js/components.js"></script>
    <script src="js/app.js"></script>
</body>
</html>