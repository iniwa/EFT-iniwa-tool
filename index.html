<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniwa's Intel Center</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "4ece1c7234fa4f6cbfb6930c36791c4d"}'></script>
    <!-- End Cloudflare Web Analytics -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F2P73S8ECS"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-F2P73S8ECS');
    </script>
    <!-- END Google tag (gtag.js) -->
</head>
<body>
    <div id="app" class="container-fluid py-4">
        
        <div v-if="loadError" class="alert alert-danger text-center">{{ loadError }}</div>

        <comp-header 
            :last-updated="lastUpdated" 
            :is-loading="isLoading" 
            v-model:player-level="playerLevel"
            @fetch-data="fetchData"
            @export-data="exportData"
            @trigger-import="triggerImport">
        </comp-header>

        <input type="file" ref="fileInput" class="d-none" accept=".json" @change="importData">

<ul class="nav nav-tabs mb-3">
            <li class="nav-item">
                <a class="nav-link" :class="{active: currentTab === 'input'}" @click="currentTab = 'input'" href="#">
                    ÈÄ≤ÊçóÂÖ•Âäõ
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" :class="{active: currentTab === 'result'}" @click="currentTab = 'result'" href="#">
                    ÂøÖË¶Å„Å™„Ç¢„Ç§„ÉÜ„É† ({{ totalItemsNeeded }})
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" :class="{active: currentTab === 'keys'}" @click="currentTab = 'keys'" href="#">
                    ÈçµÁÆ°ÁêÜ ({{ totalKeysNeeded }})
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" :class="{active: currentTab === 'flowchart'}" @click="currentTab = 'flowchart'" href="#">
                    üó∫Ô∏è Flowchart
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" :class="{active: currentTab === 'chat'}" @click="currentTab = 'chat'" href="#">
                    ü§ñ Chat
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-secondary" :class="{active: currentTab === 'debug'}" @click="currentTab = 'debug'" href="#">
                    üêû Debug
                </a>
            </li>

        </ul>

        <div v-if="currentTab === 'input'">
            <comp-input
                :hideout-data="hideoutData"
                :user-hideout="userHideout"
                :filtered-tasks-list="filteredTasksList"
                :completed-tasks="completedTasks"
                :prioritized-tasks="prioritizedTasks" 
                :task-view-mode="taskViewMode"
                :show-completed="showCompleted"
                :show-future="showFuture"
                :search-task="searchTask"
                :tasks-by-trader="tasksByTrader"
                :tasks-by-map="tasksByMap"
                :show-maxed-hideout="showMaxedHideout"
                @update:show-maxed-hideout="showMaxedHideout = $event"
                @update:task-view-mode="taskViewMode = $event"
                @update:show-completed="showCompleted = $event"
                @update:show-future="showFuture = $event"
                @update:search-task="searchTask = $event"
                @open-task-details="openTaskDetails"
                @toggle-task="toggleTask"
                @toggle-priority="togglePriority"
            ></comp-input>
        </div>

        <div v-if="currentTab === 'result'">
            <comp-result
                :shopping-list="shoppingList"
                :collected-items="collectedItems"
                :expanded-items="expandedItems"
                :display-lists="displayLists" 
                @toggle-item-details="toggleItemDetails"
                @toggle-collected="toggleCollected"
                @open-task-from-name="openTaskFromName"
            ></comp-result>
        </div>

        <div v-if="currentTab === 'keys'">
            <comp-keys
                :shopping-list="shoppingList"
                :owned-keys="ownedKeys"
                :items-data="itemsData"
                :key-user-data="keyUserData"
                :view-mode="keysViewMode"
                @update:view-mode="keysViewMode = $event"
                :sort-mode="keysSortMode" 
                @update:sort-mode="keysSortMode = $event" 
                @toggle-owned-key="toggleOwnedKey"
                @open-task-from-name="openTaskFromName"
                @update-key-user-data="updateKeyUserData"
            ></comp-keys>
        </div>

        <div v-if="currentTab === 'flowchart'">
            <comp-flowchart
                :task-data="taskData"
                :completed-tasks="completedTasks"
                :prioritized-tasks="prioritizedTasks"
                :selected-trader="flowchartTrader"
                @update:selected-trader="flowchartTrader = $event"
                @toggle-task="toggleTask"
                @open-task-details="openTaskDetails"
            ></comp-flowchart>
        </div>

        <div v-if="currentTab === 'debug'">
            <comp-debug
                :task-data="taskData"
                :hideout-data="hideoutData"
                :items-data="itemsData"
                :user-hideout="userHideout"
                :completed-tasks="completedTasks"
                :owned-keys="ownedKeys"
                :key-user-data="keyUserData"
                :prioritized-tasks="prioritizedTasks"
            ></comp-debug>
        </div>

        <div v-show="currentTab === 'chat'">
            <comp-chat
                :task-data="taskData"
                :hideout-data="hideoutData"
                :items-data="itemsData"
                :completed-tasks="completedTasks"
                :user-hideout="userHideout"
                :player-level="playerLevel"
            ></comp-chat>
        </div>

        <comp-modal
            :selected-task="selectedTask"
            :completed-tasks="completedTasks" 
            :prioritized-tasks="prioritizedTasks"
            @toggle-task="toggleTask"
            @toggle-priority="togglePriority"
            @close="selectedTask = null"
        ></comp-modal>

        <comp-footer></comp-footer>

    </div>

    <script src="data.js?=v1.0.0"></script>
    <script src="js/queries.js?=v1.0.0"></script>
    <script src="js/key_presets.js?=v1.0.0"></script> 
    <script src="js/logic_hideout.js?=v1.0.0"></script>
    <script src="js/logic_tasks.js?=v1.0.1"></script>
    <script src="js/logic_keys.js?=v1.0.0"></script>

    <script src="js/components/CompHeader.js?=v1.0.0"></script>
    <script src="js/components/CompInput.js?=v1.0.2"></script>
    <script src="js/components/CompResult.js?=v1.0.0"></script>
    <script src="js/components/CompKeys.js?=v1.0.0"></script>
    <script src="js/components/CompFlowchart.js?=v1.0.2"></script>
    <script src="js/components/CompModal.js?=v1.0.1"></script>
    <script src="js/components/CompDebug.js?=v1.0.1"></script>
    <script src="js/components/CompChat.js?=v1.0.0"></script>
    <script src="js/components/CompFooter.js?=v1.0.0"></script>
    <script src="js/app.js?=v1.0.2"></script>
</body>
</html>